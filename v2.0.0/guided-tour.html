<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>A Guided Tour · The MicroFloatingPoints Documentation</title><meta name="title" content="A Guided Tour · The MicroFloatingPoints Documentation"/><meta property="og:title" content="A Guided Tour · The MicroFloatingPoints Documentation"/><meta property="twitter:title" content="A Guided Tour · The MicroFloatingPoints Documentation"/><meta name="description" content="Documentation for The MicroFloatingPoints Documentation."/><meta property="og:description" content="Documentation for The MicroFloatingPoints Documentation."/><meta property="twitter:description" content="Documentation for The MicroFloatingPoints Documentation."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">The MicroFloatingPoints Documentation</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li class="is-active"><a class="tocitem" href="guided-tour.html">A Guided Tour</a><ul class="internal"><li><a class="tocitem" href="#Graphics-with-MicroFloatingPoints.MFPPlot"><span>Graphics with <code>MicroFloatingPoints.MFPPlot</code></span></a></li><li><a class="tocitem" href="#Random-floats-with-MicroFloatingPoints.MFPRandom"><span>Random floats with <code>MicroFloatingPoints.MFPRandom</code></span></a></li><li><a class="tocitem" href="#Arithmetic-with-various-precisions"><span>Arithmetic with various precisions</span></a></li></ul></li><li><a class="tocitem" href="manual.html">Manual</a></li><li><a class="tocitem" href="developer.html">Developer Documentation</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="guided-tour.html">A Guided Tour</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="guided-tour.html">A Guided Tour</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/goualard-f/MicroFloatingPoints.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/goualard-f/MicroFloatingPoints.jl/blob/main/docs/src/guided-tour.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="A-guided-tour"><a class="docs-heading-anchor" href="#A-guided-tour">A guided tour</a><a id="A-guided-tour-1"></a><a class="docs-heading-anchor-permalink" href="#A-guided-tour" title="Permalink"></a></h1><p>The <code>MicroFloatingPoints</code> package is organized into four modules:</p><ul><li><code>MicroFloatingPoints</code>: the main module containing the definition of the parameterized type <code>Floatmu</code> and the associated methods;</li><li><code>MicroFloatingPoints.MFPUtils</code>: a module providing miscellaneous utility functions for the <code>Floatmu</code> type;</li><li><code>MicroFloatingPoints.MFPPlot</code>: a module offering various graphical ways to display <code>Floatmu</code> floating-point numbers;</li><li><code>MicroFloatingPoints.MFPRandom</code>: the module overloading <a href="https://docs.julialang.org/en/v1/stdlib/Random/#Base.rand"><code>Random.rand</code></a> to produce <code>Floatmu</code> random values.</li></ul><p>After having correctly installed the package (see <a href="index.html#Installation">Installation</a>), we start our tour by loading the <code>MicroFloatingPoints</code> module:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using MicroFloatingPoints</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>We can now define a new floating-point type <code>MuFP</code> with 2 bits for the exponent (the first parameter)  and 2 bits for the fractional part (the second parameter):</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; MuFP = Floatmu{2,2}</code><code class="nohighlight hljs ansi" style="display:block;">Floatmu{2, 2}</code></pre><p>Such a type is very limited, and a call to <a href="manual.html#Base.floatmax-Union{Tuple{Type{Floatmu{szE, szf}}}, Tuple{szf}, Tuple{szE}} where {szE, szf}"><code>floatmax</code></a> will give us the largest finite float representable:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; floatmax(MuFP)</code><code class="nohighlight hljs ansi" style="display:block;">3.5</code></pre><p>Conversely, we can obtain the smallest positive float in the <code>MuFP</code> format with the <a href="manual.html#MicroFloatingPoints.μ-Union{Tuple{Type{Floatmu{szE, szf}}}, Tuple{szf}, Tuple{szE}} where {szE, szf}"><code>μ</code></a> method:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; μ(MuFP)</code><code class="nohighlight hljs ansi" style="display:block;">0.25</code></pre><p>Note that this value is a <a href="https://en.wikipedia.org/wiki/Denormal_number">subnormal number</a>, which is different and smaller than the smallest normal float, obtained by calling <a href="manual.html#Base.floatmin-Union{Tuple{Type{Floatmu{szE, szf}}}, Tuple{szf}, Tuple{szE}} where {szE, szf}"><code>floatmin</code></a>:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; floatmin(MuFP)</code><code class="nohighlight hljs ansi" style="display:block;">1.0</code></pre><h2 id="Graphics-with-MicroFloatingPoints.MFPPlot"><a class="docs-heading-anchor" href="#Graphics-with-MicroFloatingPoints.MFPPlot">Graphics with <code>MicroFloatingPoints.MFPPlot</code></a><a id="Graphics-with-MicroFloatingPoints.MFPPlot-1"></a><a class="docs-heading-anchor-permalink" href="#Graphics-with-MicroFloatingPoints.MFPPlot" title="Permalink"></a></h2><p>The <code>MicroFloatingPoints</code> package offers several graphical functionalities that are all available in <code>MicroFloatingPoints.MFPPlot</code> when the plotting package <code>PyPlot</code> is also loaded:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; using MicroFloatingPoints.MFPPlot, PyPlot</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Loading <code>PyPlot</code> will trigger the loading of a package extension. Alternatively, <code>PythonPlot</code> can also be used with the alias <code>const plt = pyplot</code>.</p><p>To better assess what we can do with such a small type, let us display all finite representable values on the real line. The <code>MFPPlot</code> module has just the right method:</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; real_line(-floatmax(MuFP),floatmax(MuFP));</code><code class="nohighlight hljs ansi" style="display:block;"></code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><div style="text-align: center">
<img src="./mufp_realline.svg" alt="Floatmu{2,2} representable finite values" />
</div><p>Since the difference between any pair of <code>MuFP</code> is always greater or equal to μ(MuFP), it becomes apparent why the introduction of <em>subnormal numbers</em> (in purple in the picture above) ensures the property:</p><p class="math-container">\[\forall (a,b)\in\text{MuFP}\colon |b-a| = 0 \iff a=b\]</p><p>You may also notice in the figure that the predecessor of <code>MuFP(2.0)</code>, which is <code>1.75</code>, is displayed as <code>&quot;1.8&quot;</code>. This is due to the fact that, following IEEE 754 requirements, the decimal string used to represent a <code>Floatmu</code> is the shortest that ensures a <em>correct round-trip</em> to the same <code>Floatmu</code>. For our very small format <code>Floatmu{2,2}</code>, &quot;1.8&quot; and &quot;1.75&quot; are represented by the same value; consequently, &quot;1.8&quot; is chosen over &quot;1.75&quot;.</p><h3 id="Exhaustive-search-for-rounded-additions"><a class="docs-heading-anchor" href="#Exhaustive-search-for-rounded-additions">Exhaustive search for rounded additions</a><a id="Exhaustive-search-for-rounded-additions-1"></a><a class="docs-heading-anchor-permalink" href="#Exhaustive-search-for-rounded-additions" title="Permalink"></a></h3><p>The type <code>MuFP</code> is so small that we can easily perform exhaustive searches with it. For example, we can display graphically whether the sum of any two finite <code>MuFP</code> floats needs to be rounded or not, using the <a href="manual.html#MicroFloatingPoints.inexact-Tuple{}"><code>inexact()</code></a> and <a href="manual.html#MicroFloatingPoints.reset_inexact-Tuple{}"><code>reset_inexact()</code></a> methods to, respectively, test whether the preceding computation needed rounding and to reset the global <em>inexact flag<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>:</em></p><pre><code class="language-julia hljs">plt.figure()
plt.title(&quot;Exhaustive search for rounded sums in Floatmu{2,2}&quot;)
TotalIterator = FloatmuIterator(-floatmax(MuFP),floatmax(MuFP))
N = length(TotalIterator)
Z = zeros(Int,N,N)
let i = 1
    for v1 in TotalIterator
        j = 1
        for v2 in TotalIterator
            reset_inexact()
            v=v1+v2
            Z[i,j] = 0
            if inexact()
                Z[i,j] = isfinite(v) ? 1 : 2
            end
            j += 1
        end
        i += 1
    end
end
V = collect(TotalIterator)
plt.imshow(Z,origin=&quot;lower&quot;, cmap=&quot;Oranges&quot;)
plt.yticks(0:(length(V)-1),[string(V[i]) for i in 1:length(V)])
plt.xticks(0:(length(V)-1),[string(V[i]) for i in 1:length(V)],rotation=90);</code></pre><p>Note the use of a <a href="manual.html#MicroFloatingPoints.FloatmuIterator"><code>FloatmuIterator</code></a> to enumerate all floating-point numbers in a range.</p><p>We obtain the following matrix, where a salmon cell means that the sum of the values in row and column needs no rounding, an orange cell means that the result needs rounding to be represented by a <code>Floatmu{2,2}</code>, and dark red cells represent overflowed additions.</p><div style="text-align: center">
<img src="./exhaustive-rounding.svg" alt="Exhautive search for sums of Floatmu{2,2} needing rounding" />
</div><h2 id="Random-floats-with-MicroFloatingPoints.MFPRandom"><a class="docs-heading-anchor" href="#Random-floats-with-MicroFloatingPoints.MFPRandom">Random floats with <code>MicroFloatingPoints.MFPRandom</code></a><a id="Random-floats-with-MicroFloatingPoints.MFPRandom-1"></a><a class="docs-heading-anchor-permalink" href="#Random-floats-with-MicroFloatingPoints.MFPRandom" title="Permalink"></a></h2><p>Let us now draw some <a href="https://en.wikipedia.org/wiki/Bfloat16_floating-point_format"><code>BFloat16</code></a> floats uniformly at random in <span>$[0,1)$</span>. We will use the <code>MicroFloatingPoints.MFPRandom</code> module to overload the <a href="https://docs.julialang.org/en/v1/stdlib/Random/#Base.rand"><code>rand</code></a> method for the type <code>Floatmu</code>.</p><pre><code class="language-julia hljs">using DataStructures
using PyPlot
using MicroFloatingPoints
using MicroFloatingPoints.MFPRandom

BFloat16 = Floatmu{8,7}

ndraws=1000000
plt.figure()
plt.title(&quot;Drawing $ndraws values at random in BFloat16[0,1)&quot;)
T = [rand(BFloat16) for i in 1:ndraws]
Tc = counter(T)</code></pre><p>We can now display the number of times each float was drawn:</p><pre><code class="language-julia hljs">for x in Tc
    (k,v) = x
    plot([k,k],[0,v],marker=&quot;.&quot;,color=&quot;blue&quot;,alpha=0.5)
end
(low,high) = extrema(collect(values(Tc)))
plt.ylim(ymin=0.99*low,ymax=1.01*high)</code></pre><div style="text-align: center">
<img src="./randfreq-bfloat16.svg" alt="Drawing values at random in BFloat16" />
</div><h2 id="Arithmetic-with-various-precisions"><a class="docs-heading-anchor" href="#Arithmetic-with-various-precisions">Arithmetic with various precisions</a><a id="Arithmetic-with-various-precisions-1"></a><a class="docs-heading-anchor-permalink" href="#Arithmetic-with-various-precisions" title="Permalink"></a></h2><p>The <code>BFloat16</code> and <code>Float16</code> formats both represent floating-point numbers with 16 bits. The <code>BFloat16</code> trades precision for a larger range. Let us compare the results obtained when summing the values of a vector with both types:</p><pre><code class="language-julia hljs">using MicroFloatingPoints
using Random
using Distributions
Random.seed!(42)

BFloat16 = Floatmu{8,7}
MuFloat16 = Floatmu{5,10}
T64 = [rand() for i in 1:1000]
bfT16 = [BFloat16(x) for x in T64]
FT16 = [MuFloat16(x) for x in T64]
println(sum(T64))
println(sum(bfT16))
println(sum(FT16))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">502.1034961498109
256.0
503.5</code></pre><p>For small values in <span>$[0,1)$</span>,  the effect of a smaller significand appears drastic. On the other hand, the small range of the type <code>Float16</code> makes it useless for computation with medium to large numbers:</p><pre><code class="language-julia hljs">T64 = [rand(Uniform(min(floatmin(BFloat16),floatmin(MuFloat16)),
            max(floatmax(BFloat16),floatmax(MuFloat16))/100)) for i in 1:100]
bfT16 = [BFloat16(x) for x in T64]
FT16 = [MuFloat16(x) for x in T64]
println(sum(T64))
println(sum(bfT16))
println(sum(FT16))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1.7828270493465184e38
1.7944577943096364e38
Inf</code></pre><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>More accurately, the <em>inexact flag</em> is local to each spawned <a href="https://docs.julialang.org/en/v1/base/parallel/">task</a>. That variable is not shared among tasks.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Home</a><a class="docs-footer-nextpage" href="manual.html">Manual »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.6.0 on <span class="colophon-date" title="Wednesday 18 September 2024 06:43">Wednesday 18 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
